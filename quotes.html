<!DOCTYPE html>
<html lang= "en-gb">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="Description" content="Description text here">
        <title>Quotes API testing</title>
    </head>
    <body>
        <main>
            <section id="main__section">
                Search quotes API
                <form id="searchForm">
                    <input type="text" id="searchTerm" />
                    <button>Go</button>
                </form>
            </section>
        </main>
    </body>
    <script>

        function dieIfBadResponse(response) {
            if (response.ok) {
                return response
            }  else {
                throw new Error("Response not OK")
            }
        }

        function decodeJSON(goodResponse) {
            return goodResponse.json();   //outputs JS object. 
        }

        function getFirstQuote(jsonResponse) {
            return jsonResponse.contents.quotes[0]; 
            //.contents.quotes gives an array of objects, 
            //.contents.quotes[0] gives the first object in that array
            //.contents.quotes[0] object contains a lot of info, we process the require info in getQuoteAndAuthor
        }

        function log(data){
            console.log("DATA:", data);
            return data;
        }

        function getQuoteAndAuthor(quoteObject) {
            return {author: quoteObject.author, quote: quoteObject.quote};
            //returns object with relevant info from th quote (i.e. the author and the quote itself)
        }

        function handleErrors(error) {
            console.error(error.message);
        } 

        function getQuote(searchString, callback, errorHandler){
            console.log("Searching API for ", searchString);
            initObject = { 
                headers : {'X-TheySaidSo-Api-Secret':'OtEYEgN0fx1d3lDOJYVWFweF'} //API key
            }
            searchParams = "minlength=60&maxlength=150&sfw=True";   //determines legnth of quote (need to fix sfw/"no swear word" bug)
            fetch(`http://quotes.rest/quote/search.json?${searchParams}&query=${searchString}`, initObject)
            .then(dieIfBadResponse)  // the object fetch returns should have a property .ok
            .then(decodeJSON)        // we need to run the .json() method on the raw object
            .then(getFirstQuote)     // we need the first element of the Array at object.contents.quotes
            .then(getQuoteAndAuthor) // we need to return author and quote in our own object
            .then(callback)          // we need to call the callback with the object we received
            .catch(errorHandler);    // we need to do something with any errors objects we get
        }
        
        function submitHandler(event){
            event.preventDefault();
            const searchInput = document.getElementById("searchTerm"); // change to search Input
            getQuote(searchInput.value, console.log, handleErrors)
        }

        const searchForm = document.getElementById("searchForm"); //might need to change to "search"
        searchForm.onsubmit = submitHandler; //.onsubmit is a browser event that allows the form to be submitted by clicking the button (or pressing "enter")

    </script>
</html>

